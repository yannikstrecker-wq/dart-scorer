<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Dart Turnier</title>

<style>
:root{
  --green:#1e7f4f;
  --red:#b8322a;
  --gold:#d4af37;
  --bg:#050806;
  --text:#f5f5f5;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top,#1b5e3a 0%,#050806 70%);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  color:var(--text);
  padding:10px;
}
.app{max-width:1200px;margin:auto}

/* HEADER */
.header{
  text-align:center;
  padding:12px;
  border:2px solid var(--gold);
  border-radius:14px;
  background:#000;
  margin-bottom:12px;
}
.header h1{margin:0;color:var(--gold)}
.header p{margin:4px 0 0;font-size:13px;color:#aaa}

/* PANELS */
.panel{
  background:#111;
  padding:12px;
  border-radius:14px;
  margin-bottom:12px;
}

/* TABLE */
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border-bottom:1px solid #333;padding:6px;text-align:center}
th{color:var(--gold)}
tr.qualify{color:#9cffc8}
tr.out{color:#666}

/* KO */
.ko{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:10px;
  text-align:center;
}
.round{
  background:#000;
  border:2px solid #333;
  border-radius:10px;
  padding:8px;
}
.round.active{border-color:var(--gold)}
.winner{color:var(--gold);font-weight:900}

/* MATCH */
.scores{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.playerBox{
  background:#000;
  border:2px solid #0f5d35;
  border-radius:12px;
  padding:10px;
}
.playerBox.active{border-color:var(--gold)}
.score{font-size:42px;font-weight:900}

/* INPUT */
.modes{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:6px;
}
.mode{
  padding:10px;
  font-weight:900;
  border-radius:10px;
  border:2px solid #0f5d35;
  background:#000;
}
.mode.active.single{background:#333}
.mode.active.double{background:var(--green);color:#000}
.mode.active.triple{background:var(--red)}

.numbers{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:6px;
}
.num{
  padding:14px;
  font-size:18px;
  font-weight:900;
  background:#000;
  color:#eaeaea;
  border:2px solid #0f5d35;
  border-radius:10px;
}
.double{color:#003300}
.triple{color:#fff}
.bull{color:#ffd700}
.num:disabled{opacity:.3}

/* ACTIONS */
.actions{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  margin-top:8px;
}
.btn{
  padding:14px;
  font-size:16px;
  font-weight:900;
  border-radius:12px;
  border:none;
}
.green{background:var(--green);color:#000}
.red{background:var(--red);color:#fff}

/* STATS */
.statBtn{
  position:fixed;
  right:14px;
  bottom:14px;
  background:var(--gold);
  color:#000;
  font-weight:900;
  padding:12px 14px;
  border-radius:50%;
  border:none;
  font-size:18px;
}

/* OVERLAY */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.overlay.show{display:flex}
.box{
  background:#000;
  padding:24px;
  border-radius:16px;
  border:3px solid var(--gold);
  max-width:500px;
  width:90%;
}
</style>
</head>

<body>
<div class="app">

<div class="header">
  <h1>üéØ Dart Turnier</h1>
  <p>6 Spieler ¬∑ Gruppen ‚Üí KO ¬∑ Best of 3 ¬∑ Double Out</p>
</div>

<div class="panel">
  <h3>Gruppentabellen</h3>
  <div id="groupTables"></div>
</div>

<div class="panel">
  <h3>KO-Baum</h3>
  <div class="ko" id="koTree"></div>
</div>

<div class="panel">
  <h2 id="matchTitle"></h2>
  <div class="scores">
    <div class="playerBox active" id="box0">
      <div>
        <span id="name0"></span>
        <button onclick="editName(0)">‚úèÔ∏è</button>
      </div>
      <div class="score" id="score0">501</div>
      Legs: <span id="legs0">0</span>
    </div>
    <div class="playerBox" id="box1">
      <div>
        <span id="name1"></span>
        <button onclick="editName(1)">‚úèÔ∏è</button>
      </div>
      <div class="score" id="score1">501</div>
      Legs: <span id="legs1">0</span>
    </div>
  </div>
</div>

<div class="panel">
  <div class="modes">
    <button class="mode single active" onclick="setMode(1)">SINGLE</button>
    <button class="mode double" onclick="setMode(2)">DOUBLE</button>
    <button class="mode triple" onclick="setMode(3)">TRIPLE</button>
  </div>

  <div class="numbers" id="numbers"></div>

  <div class="actions">
    <button class="btn red" onclick="undo()">Undo</button>
    <button class="btn green" onclick="nextTurn()">Weiter</button>
  </div>
</div>

</div>

<button class="statBtn" onclick="openStats()">üìä</button>

<div class="overlay" id="statsOverlay">
  <div class="box">
    <h2>Spieler-Statistik</h2>
    <div id="statsContent"></div><br>
    <button class="btn green" onclick="closeStats()">Schlie√üen</button>
  </div>
</div>

<script>
/* ===== SPIELER ===== */
let players=["A1","A2","A3","B1","B2","B3"];
const stats=players.map(()=>({matches:0,wins:0,legs:0,darts:0,points:0}));

/* ===== GRUPPEN ===== */
const groups=[
  {name:"Gruppe A",idx:[0,1,2],wins:[0,0,0],legs:[0,0,0]},
  {name:"Gruppe B",idx:[3,4,5],wins:[0,0,0],legs:[0,0,0]}
];

/* ===== MATCHES ===== */
let stage="groups";
let matches=[
  {a:0,b:1,g:0},{a:0,b:2,g:0},{a:1,b:2,g:0},
  {a:3,b:4,g:1},{a:3,b:5,g:1},{a:4,b:5,g:1}
];
let koMatches=[];
let matchIndex=0;

/* ===== GAME STATE ===== */
let scores=[501,501],legs=[0,0],current=0,throws=0;
let history=[],mode=1;

/* ===== INPUT ===== */
const nums=document.getElementById("numbers");
for(let i=1;i<=20;i++)addNum(i);
addNum(25,"Bull","bull");
addNum(50,"DBull","bull");
addNum(0,"0");

function addNum(v,label,cls){
  const b=document.createElement("button");
  b.className="num "+(cls||"");
  b.textContent=label||v;
  b.addEventListener("pointerdown",()=>throwDart(v));
  nums.appendChild(b);
}

/* ===== LOGIK ===== */
function loadMatch(){
  scores=[501,501];legs=[0,0];current=0;throws=0;history=[];
  const m=getMatch();
  name0.textContent=players[m.a];
  name1.textContent=players[m.b];
  matchTitle.textContent=`${players[m.a]} vs ${players[m.b]}`;
  updateUI();
}

function getMatch(){
  return stage==="groups"?matches[matchIndex]:koMatches[matchIndex];
}

function throwDart(v){
  if(throws>=3)return;
  let val=v<=20?v*mode:v;
  scores[current]-=val;
  history.push(val);
  const p=getMatch()[current===0?"a":"b"];
  stats[p].darts++; stats[p].points+=val;
  throws++; setMode(1); updateUI();
}

function undo(){
  if(!history.length)return;
  const v=history.pop();
  scores[current]+=v; throws--; updateUI();
}

function nextTurn(){
  if(scores[current]===0 && history.at(-1)%2===0){
    legs[current]++; stats[getMatch()[current===0?"a":"b"]].legs++;
    if(legs[current]===2){ endMatch(); return; }
    scores=[501,501];
  }else if(scores[current]<0||scores[current]===1){
    scores[current]=501;
  }
  throws=0; history=[]; current=1-current; updateUI();
}

function endMatch(){
  const m=getMatch();
  stats[m.a].matches++; stats[m.b].matches++;
  stats[current===0?m.a:m.b].wins++;

  if(stage==="groups"){
    const g=groups[m.g];
    const idx=g.idx.indexOf(current===0?m.a:m.b);
    g.wins[idx]++; g.legs[idx]+=legs[current];
  }

  matchIndex++;
  if(stage==="groups" && matchIndex===matches.length)buildKO();
  loadMatch();
}

function buildKO(){
  groups.forEach(g=>{
    g.rank=[0,1,2].sort((a,b)=>g.wins[b]-g.wins[a]||g.legs[b]-g.legs[a]);
  });
  koMatches=[
    {a:groups[0].idx[groups[0].rank[0]],b:groups[1].idx[groups[1].rank[1]]},
    {a:groups[1].idx[groups[1].rank[0]],b:groups[0].idx[groups[0].rank[1]]}
  ];
  stage="ko"; matchIndex=0;
  renderKO(); renderTables();
}

/* ===== UI ===== */
function renderTables(){
  groupTables.innerHTML="";
  groups.forEach(g=>{
    let order=[0,1,2].sort((a,b)=>g.wins[b]-g.wins[a]||g.legs[b]-g.legs[a]);
    let html=`<h4>${g.name}</h4><table><tr><th>Spieler</th><th>Siege</th><th>Legs</th></tr>`;
    order.forEach((i,idx)=>{
      html+=`<tr class="${idx<2?'qualify':'out'}"><td>${players[g.idx[i]]}</td><td>${g.wins[i]}</td><td>${g.legs[i]}</td></tr>`;
    });
    html+="</table>";
    groupTables.innerHTML+=html;
  });
}

function renderKO(){
  koTree.innerHTML=`
    <div class="round active">HF 1<br>${players[koMatches[0].a]} vs ${players[koMatches[0].b]}</div>
    <div class="round">Finale<br><span class="winner">‚Äì</span></div>
    <div class="round active">HF 2<br>${players[koMatches[1].a]} vs ${players[koMatches[1].b]}</div>`;
}

function updateUI(){
  score0.textContent=scores[0];
  score1.textContent=scores[1];
  legs0.textContent=legs[0];
  legs1.textContent=legs[1];
  box0.classList.toggle("active",current===0);
  box1.classList.toggle("active",current===1);
}

function setMode(m){
  mode=m;
  document.querySelectorAll(".mode").forEach(b=>b.classList.remove("active"));
  document.querySelector(`.mode.${m===1?"single":m===2?"double":"triple"}`).classList.add("active");
}

/* ===== STATS ===== */
function openStats(){
  let html="<table><tr><th>Spieler</th><th>Matches</th><th>Siege</th><th>Legs</th><th>Darts</th><th>√ò</th></tr>";
  stats.forEach((s,i)=>{
    const avg=s.darts?((s.points/s.darts)*3).toFixed(1):"0.0";
    html+=`<tr><td>${players[i]}</td><td>${s.matches}</td><td>${s.wins}</td><td>${s.legs}</td><td>${s.darts}</td><td>${avg}</td></tr>`;
  });
  html+="</table>";
  statsContent.innerHTML=html;
  statsOverlay.classList.add("show");
}
function closeStats(){statsOverlay.classList.remove("show");}

/* ===== NAME EDIT ===== */
function editName(local){
  const m=getMatch();
  const idx=local===0?m.a:m.b;
  const n=prompt("Neuer Name:",players[idx]);
  if(!n)return;
  players[idx]=n;
  loadMatch(); renderTables(); renderKO();
}

/* START */
renderTables(); renderKO(); loadMatch();
</script>
</body>
</html>
