<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dart Turnier â€“ Stabil</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#0c1f15;
  color:#fff;
  padding:12px;
}
h1{text-align:center}
.panel{
  background:#111;
  padding:12px;
  border-radius:12px;
  margin-bottom:12px;
}
button{
  padding:12px;
  font-weight:bold;
  margin:4px;
}
input{padding:8px;width:100%;margin-bottom:6px}

.players{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.active{border:2px solid gold}
.score{font-size:32px}

.overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.85);
  display:none;align-items:center;justify-content:center;
}
.overlay.show{display:flex}
.box{
  background:#000;padding:20px;border-radius:12px;
  width:90%;max-width:400px;
}
</style>
</head>

<body>

<h1>ðŸŽ¯ Dart Turnier</h1>

<!-- SETUP -->
<div class="panel" id="setup">
  <h3>Spieler eingeben</h3>
  <input id="p0" placeholder="Spieler A1">
  <input id="p1" placeholder="Spieler A2">
  <input id="p2" placeholder="Spieler A3">
  <input id="p3" placeholder="Spieler B1">
  <input id="p4" placeholder="Spieler B2">
  <input id="p5" placeholder="Spieler B3">
  <button onclick="startTournament()">Turnier starten</button>
</div>

<!-- GAME -->
<div class="panel" id="game" style="display:none">
  <h3 id="matchTitle"></h3>

  <div class="players">
    <div id="pBox0">
      <div id="n0"></div>
      <div class="score" id="s0">501</div>
      Legs: <span id="l0">0</span>
    </div>
    <div id="pBox1">
      <div id="n1"></div>
      <div class="score" id="s1">501</div>
      Legs: <span id="l1">0</span>
    </div>
  </div>

  <p id="throws">Aufnahme: â€“</p>
  <p id="checkout">Checkout: â€“</p>

  <button onclick="throwDart(60)">T20</button>
  <button onclick="throwDart(20)">20</button>
  <button onclick="throwDart(5)">5</button>
  <button onclick="nextTurn()">Weiter</button>
</div>

<button onclick="openStats()">ðŸ“Š Statistik</button>
<button onclick="openCalendar()">ðŸ“… Kalender</button>

<!-- STATS -->
<div class="overlay" id="stats">
  <div class="box">
    <h3>Statistik</h3>
    <div id="statsContent"></div>
    <button onclick="closeStats()">OK</button>
  </div>
</div>

<!-- CALENDAR -->
<div class="overlay" id="calendar">
  <div class="box">
    <h3>Spielplan</h3>
    <div id="calendarContent"></div>
    <button onclick="closeCalendar()">OK</button>
  </div>
</div>

<script>
/* ===== STATE ===== */
let players=[];
let matches=[];
let matchIndex=0;
let current=0;
let score=[501,501];
let legs=[0,0];
let darts=[];
let stats=[];

/* ===== CHECKOUT ===== */
const checkoutMap={
170:"T20 T20 Bull",167:"T20 T19 Bull",164:"T20 T18 Bull",
161:"T20 T17 Bull",160:"T20 T20 D20",100:"T20 D20",
80:"T20 D10",60:"20 D20",50:"Bull",40:"D20",
32:"D16",24:"D12",16:"D8",8:"D4",4:"D2",2:"D1"
};

/* ===== START ===== */
function startTournament(){
  players=[];
  stats=[];
  for(let i=0;i<6;i++){
    const v=document.getElementById("p"+i).value||"Spieler "+(i+1);
    players.push(v);
    stats.push({throws:0,points:0});
  }

  matches=[
    {a:0,b:1},{a:3,b:4},
    {a:0,b:2},{a:3,b:5},
    {a:1,b:2},{a:4,b:5}
  ];

  document.getElementById("setup").style.display="none";
  document.getElementById("game").style.display="block";
  loadMatch();
}

/* ===== GAME ===== */
function loadMatch(){
  score=[501,501];
  legs=[0,0];
  darts=[];
  current=0;

  const m=matches[matchIndex];
  n0.textContent=players[m.a];
  n1.textContent=players[m.b];
  matchTitle.textContent=players[m.a]+" vs "+players[m.b];
  updateUI();
}

function throwDart(v){
  if(darts.length>=3)return;
  score[current]-=v;
  darts.push(v);
  stats[current].throws++;
  stats[current].points+=v;
  updateUI();
}

function nextTurn(){
  const last=darts[darts.length-1];
  if(score[current]===0 && last%2===0){
    legs[current]++;
    if(legs[current]===2){
      alert(players[current]+" gewinnt das Match");
      matchIndex++;
      if(matchIndex<matches.length) loadMatch();
      return;
    }
    score=[501,501];
  }
  if(score[current]<0||score[current]===1){
    score[current]+=darts.reduce((a,b)=>a+b,0);
  }
  darts=[];
  current=1-current;
  updateUI();
}

function updateUI(){
  s0.textContent=score[0];
  s1.textContent=score[1];
  l0.textContent=legs[0];
  l1.textContent=legs[1];
  throws.textContent=darts.length?"Aufnahme: "+darts.join(" | "):"Aufnahme: â€“";
  checkout.textContent=checkoutMap[score[current]]?
    "Checkout: "+checkoutMap[score[current]]:"Checkout: â€“";
}

/* ===== STATS ===== */
function openStats(){
  statsContent.innerHTML=players.map((p,i)=>
    `${p}: Ã˜ ${stats[i].throws?((stats[i].points/stats[i].throws)*3).toFixed(1):"0.0"}`
  ).join("<br>");
  stats.classList.add("show");
}
function closeStats(){stats.classList.remove("show")}

/* ===== CALENDAR ===== */
function openCalendar(){
  calendarContent.innerHTML=matches.map(m=>players[m.a]+" vs "+players[m.b]).join("<br>");
  calendar.classList.add("show");
}
function closeCalendar(){calendar.classList.remove("show")}
</script>

</body>
</html>
