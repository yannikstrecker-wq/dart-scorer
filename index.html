<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Dart Turnier</title>

<style>
:root{
  --green:#1e7f4f;
  --red:#b8322a;
  --gold:#d4af37;
  --bg:#050806;
  --text:#f5f5f5;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top,#1b5e3a 0%,#050806 70%);
  font-family:system-ui;
  color:var(--text);
  padding:10px;
}
.app{max-width:1200px;margin:auto}
.panel{background:#111;padding:12px;border-radius:14px;margin-bottom:12px}
.header{text-align:center;border:2px solid var(--gold);border-radius:14px;padding:12px;background:#000}

/* TABLES */
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border-bottom:1px solid #333;padding:6px;text-align:center}
th{color:var(--gold)}
.qualify{color:#9cffc8}

/* MATCH */
.scores{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.playerBox{background:#000;border:2px solid #0f5d35;border-radius:12px;padding:10px}
.playerBox.active{border-color:var(--gold)}
.score{font-size:42px;font-weight:900}
.throws{text-align:center;font-weight:800;color:#9cffc8}
.checkout{text-align:center;font-weight:700;color:#ffd700}

/* INPUT */
.modes{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.mode{padding:10px;font-weight:900;border-radius:10px;border:2px solid #0f5d35;background:#000}
.mode.active.double{background:var(--green);color:#000}
.mode.active.triple{background:var(--red)}
.mode.active.single{background:#333}

.numbers{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
.num{padding:14px;font-size:18px;font-weight:900;background:#000;color:#fff;border:2px solid #0f5d35;border-radius:10px}
.bull{color:#ffd700}

/* BUTTONS */
.actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
.btn{padding:14px;font-weight:900;border-radius:12px;border:none}
.green{background:var(--green);color:#000}
.red{background:var(--red);color:#fff}

/* FLOAT */
.statBtn,.calBtn{
  position:fixed;bottom:14px;
  background:var(--gold);color:#000;
  font-weight:900;border-radius:50%;border:none;
  padding:12px 14px;font-size:18px
}
.statBtn{right:14px}
.calBtn{left:14px}

/* OVERLAY */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:999}
.overlay.show{display:flex}
.box{background:#000;border:3px solid var(--gold);border-radius:16px;padding:24px;width:90%;max-width:520px;text-align:center}
.matchRow{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #333}
.live{color:var(--gold)}
.done{color:#9cffc8}
</style>
</head>

<body>
<div class="app">

<div class="header">
  <h1>ðŸŽ¯ Dart Turnier</h1>
</div>

<div class="panel" id="setup">
  <h3>Spielernamen</h3>
  <input id="p0" placeholder="Spieler A1">
  <input id="p1" placeholder="Spieler A2">
  <input id="p2" placeholder="Spieler A3">
  <input id="p3" placeholder="Spieler B1">
  <input id="p4" placeholder="Spieler B2">
  <input id="p5" placeholder="Spieler B3">
  <button class="btn green" onclick="start()">Start</button>
</div>

<div id="game" style="display:none">

<div class="panel">
  <h3>Gruppentabellen</h3>
  <div id="tables"></div>
</div>

<div class="panel">
  <h3>KO-Baum</h3>
  <div id="koTree"></div>
</div>

<div class="panel">
  <h2 id="matchTitle"></h2>
  <div class="scores">
    <div class="playerBox active" id="box0">
      <div id="n0"></div>
      <div class="score" id="s0">501</div>
      Legs <span id="l0">0</span>
    </div>
    <div class="playerBox" id="box1">
      <div id="n1"></div>
      <div class="score" id="s1">501</div>
      Legs <span id="l1">0</span>
    </div>
  </div>
  <div class="throws" id="throws">Aufnahme: â€“</div>
  <div class="checkout" id="checkout">Checkout: â€“</div>
</div>

<div class="panel">
  <div class="modes">
    <button class="mode single active" onclick="setMode(1)">S</button>
    <button class="mode double" onclick="setMode(2)">D</button>
    <button class="mode triple" onclick="setMode(3)">T</button>
  </div>
  <div class="numbers" id="nums"></div>
  <div class="actions">
    <button class="btn red" onclick="undo()">Undo</button>
    <button class="btn green" onclick="next()">Weiter</button>
  </div>
</div>

</div>

<button class="calBtn" onclick="openCalendar()">ðŸ“…</button>
<button class="statBtn" onclick="openStats()">ðŸ“Š</button>

<!-- OVERLAYS -->
<div class="overlay" id="calendar"><div class="box"><h2>SpielÃ¼bersicht</h2><div id="calList"></div><button class="btn green" onclick="closeCalendar()">OK</button></div></div>
<div class="overlay" id="stats"><div class="box"><h2>Statistik</h2><div id="statList"></div><button class="btn green" onclick="closeStats()">OK</button></div></div>
<div class="overlay" id="round"><div class="box"><h2 id="roundTxt"></h2><p>Steve, du hast einen schÃ¶nen Christbaum ðŸŽ„</p><button class="btn green" onclick="closeRound()">Weiter</button></div></div>

<script>
/* ================= STATE ================= */
let players=[],stats=[],groups=[],matches=[],ko=[],stage="groups";
let matchIndex=0,current=0,mode=1,throws=0;
let score=[501,501],legs=[0,0],darts=[];

/* ================= START ================= */
function start(){
  players=[p0,p1,p2,p3,p4,p5].map((p,i)=>p.value||`Spieler ${i+1}`);
  stats=players.map(()=>({darts:0,points:0,legs:0,matches:0}));

  groups=[
    {idx:[0,1,2],wins:[0,0,0],legs:[0,0,0]},
    {idx:[3,4,5],wins:[0,0,0],legs:[0,0,0]}
  ];

  matches=[
    {a:0,b:1,g:0},{a:3,b:4,g:1},
    {a:0,b:2,g:0},{a:3,b:5,g:1},
    {a:1,b:2,g:0},{a:4,b:5,g:1}
  ];

  setup.style.display="none";
  game.style.display="block";
  buildNums();
  renderTables();
  loadMatch();
}

/* ================= GAME ================= */
function buildNums(){
  nums.innerHTML="";
  for(let i=1;i<=20;i++)addNum(i);
  addNum(25,"Bull","bull");
  addNum(50,"DBull","bull");
  addNum(0,"0");
}
function addNum(v,l,c){
  let b=document.createElement("button");
  b.className="num "+(c||"");
  b.textContent=l||v;
  b.onclick=()=>throwDart(v);
  nums.appendChild(b);
}

function loadMatch(){
  score=[501,501];legs=[0,0];current=0;throws=0;darts=[];
  let m=stage==="groups"?matches[matchIndex]:ko[matchIndex];
  n0.textContent=players[m.a];
  n1.textContent=players[m.b];
  matchTitle.textContent=(stage==="groups"?"Gruppe":"KO")+`: ${players[m.a]} vs ${players[m.b]}`;
  update();
}

function throwDart(v){
  if(throws>=3)return;
  let val=v<=20?v*mode:v;
  score[current]-=val;
  darts.push((mode===2?"D":mode===3?"T":"")+v);
  let p=(stage==="groups"?matches[matchIndex]:ko[matchIndex])[current===0?"a":"b"];
  stats[p].darts++;stats[p].points+=val;
  throws++;setMode(1);update();
}

function undo(){
  if(!darts.length)return;
  let last=darts.pop();
  score[current]+=parseInt(last.replace(/\D/g,""));
  throws--;update();
}

function next(){
  if(score[current]===0 && (darts.at(-1).startsWith("D")||darts.at(-1)==="50")){
    legs[current]++;
    stats[(stage==="groups"?matches[matchIndex]:ko[matchIndex])[current===0?"a":"b"]].legs++;
    roundTxt.textContent=`ðŸ† Runde gewonnen von ${current===0?n0.textContent:n1.textContent}`;
    round.classList.add("show");
    return;
  }
  if(score[current]<0||score[current]===1){
    score[current]+=darts.reduce((s,d)=>s+parseInt(d.replace(/\D/g,"")),0);
  }
  current=1-current;throws=0;darts=[];update();
}

function closeRound(){
  round.classList.remove("show");
  matchIndex++;
  renderTables();
  if(stage==="groups" && matchIndex===matches.length){
    buildKO();return;
  }
  if(stage==="ko" && matchIndex===ko.length){
    alert("Turnier beendet");
    return;
  }
  loadMatch();
}

/* ================= KO ================= */
function buildKO(){
  stage="ko";matchIndex=0;
  let a=[0,1,2].sort((x,y)=>groups[0].wins[y]-groups[0].wins[x])[0];
  let b=[0,1,2].sort((x,y)=>groups[1].wins[y]-groups[1].wins[x])[0];
  ko=[
    {a:groups[0].idx[a],b:groups[1].idx[b]},
    {a:groups[1].idx[b],b:groups[0].idx[a]}
  ];
  renderKO();
  loadMatch();
}

function renderKO(){
  koTree.innerHTML="";
  ko.forEach((m,i)=>{
    koTree.innerHTML+=`<div>${i<2?"Halbfinale":"Finale"}: ${players[m.a]} vs ${players[m.b]}</div>`;
  });
}

/* ================= UI ================= */
function update(){
  s0.textContent=score[0];s1.textContent=score[1];
  l0.textContent=legs[0];l1.textContent=legs[1];
  box0.classList.toggle("active",current===0);
  box1.classList.toggle("active",current===1);
  throws.textContent=darts.length?"Aufnahme: "+darts.join(" | "):"Aufnahme: â€“";
  updateCheckout();
}

function updateCheckout(){
  const map={170:"T20 T20 Bull",100:"T20 D20",50:"Bull",40:"D20",32:"D16",24:"D12",16:"D8",8:"D4",4:"D2",2:"D1"};
  checkout.textContent=map[score[current]]?"Checkout: "+map[score[current]]:"Checkout: â€“";
}

function renderTables(){
  tables.innerHTML="";
  groups.forEach((g,i)=>{
    let html=`<h4>Gruppe ${i===0?"A":"B"}</h4><table><tr><th>Spieler</th><th>Siege</th><th>Legs</th></tr>`;
    g.idx.forEach((p,j)=>html+=`<tr><td>${players[p]}</td><td>${g.wins[j]}</td><td>${g.legs[j]}</td></tr>`);
    html+="</table>";
    tables.innerHTML+=html;
  });
}

/* ================= OVERLAYS ================= */
function openCalendar(){
  calList.innerHTML="";
  [...matches,...ko].forEach((m,i)=>{
    calList.innerHTML+=`<div class="matchRow ${i===matchIndex?'live':i<matchIndex?'done':''}">
      ${players[m.a]} vs ${players[m.b]}
    </div>`;
  });
  calendar.classList.add("show");
}
function closeCalendar(){calendar.classList.remove("show")}

function openStats(){
  statList.innerHTML="<table><tr><th>Spieler</th><th>Ã˜</th><th>Legs</th></tr>";
  stats.forEach((s,i)=>{
    let avg=s.darts?((s.points/s.darts)*3).toFixed(1):"0.0";
    statList.innerHTML+=`<tr><td>${players[i]}</td><td>${avg}</td><td>${s.legs}</td></tr>`;
  });
  statList.innerHTML+="</table>";
  stats.classList.add("show");
}
function closeStats(){stats.classList.remove("show")}

function setMode(m){
  mode=m;
  document.querySelectorAll(".mode").forEach(b=>b.classList.remove("active"));
  document.querySelector(`.mode.${m===1?"single":m===2?"double":"triple"}`).classList.add("active");
}
</script>
</body>
</html>
