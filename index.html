<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dart Web App</title>
<style>
:root{
  --green:#1e7f4f;
  --red:#b8322a;
  --gold:#d4af37;
  --bg:#050806;
  --panel:#111;
  --text:#f5f5f5;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top,#1b5e3a 0%,var(--bg) 70%);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  color:var(--text);
  padding:8px;
}
.app{max-width:1200px;margin:auto}
.header{
  display:flex;align-items:center;gap:8px;justify-content:space-between;
  border:2px solid var(--gold);border-radius:14px;padding:8px;background:#000;margin-bottom:8px
}
.header .status{color:var(--gold);font-weight:900}
.header button{
  background:#000;color:var(--gold);
  border:2px solid var(--gold);border-radius:10px;padding:6px 10px;font-weight:900
}
.panel{background:var(--panel);padding:10px;border-radius:14px;margin-bottom:8px}
.hidden{display:none}

/* Buttons */
.modes{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.mode{
  padding:10px;font-weight:900;border-radius:10px;
  border:2px solid #0f5d35;background:#000;color:#eee
}
.mode.active{background:var(--gold);color:#000}

/* Input */
.numbers{display:grid;grid-template-columns:repeat(6,1fr);gap:6px}
.num{
  padding:14px;font-size:18px;font-weight:900;background:#000;color:#fff;
  border:2px solid #0f5d35;border-radius:10px
}
.bull{color:#ffd700}
.quickInput{display:flex;gap:6px;margin-top:6px}
.quickInput input{
  flex:1;padding:10px;border-radius:8px;border:2px solid #333;
  background:#000;color:#fff;text-align:center;font-weight:900
}
.quickInput button{
  padding:10px 14px;border-radius:8px;border:none;font-weight:900;background:var(--gold)
}
.actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
.btn{padding:14px;font-weight:900;border-radius:12px;border:none}
.green{background:var(--green);color:#000}
.red{background:var(--red);color:#fff}

/* 501 */
.scores{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.playerBox{
  background:#000;border:2px solid #0f5d35;border-radius:12px;padding:10px
}
.playerBox.active{border-color:var(--gold)}
.score{font-size:42px;font-weight:900}
.sub{font-weight:800;opacity:.9}
.checkout{color:#ffd700;font-weight:900}

/* Cricket Layout B */
.cricketHeader{
  display:grid;grid-template-columns:1fr auto 1fr;gap:6px;text-align:center;margin-bottom:4px
}
.cricketGrid{
  display:grid;grid-template-columns:1fr 60px 1fr;row-gap:6px;align-items:center
}
.center{font-weight:900;text-align:center}
.marks{display:flex;justify-content:center;gap:4px}
.mark{width:8px;height:18px;background:#333;border-radius:3px}
.mark.on{background:var(--gold)}
.activePlayer{outline:2px solid var(--gold);border-radius:6px}
.scoreBox{text-align:center;font-weight:900}

/* Tables */
.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #333;padding:6px;text-align:center}
.table th{color:var(--gold)}

/* Mobile */
@media (max-width:768px){
  .score{font-size:34px}
  .num{padding:12px}
}
@media (max-width:480px){
  .marks .mark{height:14px;width:6px}
  .numbers{grid-template-columns:repeat(5,1fr)}
}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="status" id="status">StartmenÃ¼</div>
    <div style="display:flex;gap:6px">
      <button onclick="showStats()">ðŸ“Š Statistiken</button>
      <button onclick="resetAppState()">â¬… ZurÃ¼ck ins MenÃ¼</button>
    </div>
  </div>

  <!-- Start -->
  <div id="start" class="panel">
    <div class="modes">
      <button class="mode active" onclick="start501()">501 â€“ 1vs1</button>
      <button class="mode" onclick="startCricket()">Cricket â€“ 1vs1</button>
      <button class="mode" onclick="start501Tournament()">501 â€“ Turnier</button>
      <button class="mode" onclick="startCricketTournament()">Cricket â€“ Turnier</button>
    </div>
  </div>

  <!-- Tournament Setup -->
  <div id="setup" class="panel hidden">
    <div class="sub" style="color:var(--gold)" id="setupTitle"></div>
    <label>Spieleranzahl (4â€“7)</label>
    <input id="pCount" type="number" min="4" max="7" value="4" />
    <div style="margin-top:6px">
      <button class="mode active" id="g1" onclick="setGroups(1)">1 Gruppe</button>
      <button class="mode" id="g2" onclick="setGroups(2)">2 Gruppen</button>
    </div>
    <div id="names" style="margin-top:8px"></div>
    <button class="btn green" onclick="confirmSetup()">Start</button>
  </div>

  <!-- 501 Game -->
  <div id="game501" class="panel hidden">
    <div class="scores">
      <div class="playerBox active" id="p0">
        <div class="sub" id="p0n"></div>
        <div class="score" id="s0"></div>
        <div class="checkout" id="c0"></div>
      </div>
      <div class="playerBox" id="p1">
        <div class="sub" id="p1n"></div>
        <div class="score" id="s1"></div>
        <div class="checkout" id="c1"></div>
      </div>
    </div>
  </div>

  <!-- Cricket Game -->
  <div id="gameCricket" class="panel hidden">
    <div class="cricketHeader">
      <div id="cn0"></div><div>ZIEL</div><div id="cn1"></div>
    </div>
    <div class="cricketHeader">
      <div id="cp0" class="scoreBox"></div><div></div><div id="cp1" class="scoreBox"></div>
    </div>
    <div class="cricketGrid" id="cgrid"></div>
  </div>

  <!-- Input -->
  <div id="input" class="panel hidden">
    <div class="modes">
      <button class="mode active" onclick="setMult(1)">Single</button>
      <button class="mode" onclick="setMult(2)">Double</button>
      <button class="mode" onclick="setMult(3)">Triple</button>
    </div>
    <div class="numbers" id="nums"></div>
    <div class="quickInput">
      <input id="manual" type="number" min="0" max="60" placeholder="Wurf" />
      <button onclick="manualThrow()">OK</button>
    </div>
    <div class="actions">
      <button class="btn red" onclick="undo()">Undo</button>
      <button class="btn green" onclick="nextTurn()">Weiter</button>
    </div>
  </div>

  <!-- Tables / Stats -->
  <div id="tablePanel" class="panel hidden"></div>
</div>

<script>
/* GLOBAL STATE */
let mode=null, submode=null;
let players=[], turn=0, mult=1, history=[];
let scores501=[501,501];
let cricket=null;
let groups=1, tournament=null;
const cricketTargets=[20,19,18,17,16,15,25];
const statsKey='dart_stats_v1';

/* UI BUILD */
const nums=document.getElementById('nums');
(function(){
  for(let i=0;i<=20;i++){
    let b=document.createElement('button');b.className='num';b.textContent=i;
    b.onclick=()=>throwDart(i*mult);nums.appendChild(b);
  }
  let b25=document.createElement('button');b25.className='num bull';b25.textContent='BULL';
  b25.onclick=()=>throwDart(25);nums.appendChild(b25);
  let b50=document.createElement('button');b50.className='num bull';b50.textContent='DBULL';
  b50.onclick=()=>throwDart(50);nums.appendChild(b50);
})();

/* RESET */
function resetAppState(){
  mode=submode=null; players=[]; turn=0; mult=1; history=[];
  scores501=[501,501]; cricket=null; tournament=null; groups=1;
  hideAll(); document.getElementById('start').classList.remove('hidden');
  setStatus('StartmenÃ¼');
}
function hideAll(){
  ['start','setup','game501','gameCricket','input','tablePanel'].forEach(id=>{
    document.getElementById(id).classList.add('hidden');
  });
}
function setStatus(t){ document.getElementById('status').textContent=t; }

/* START MODES */
function start501(){
  hideAll(); setStatus('501 â€“ Double Out');
  mode='501'; submode='single';
  players=['Spieler 1','Spieler 2']; scores501=[501,501]; turn=0; history=[];
  document.getElementById('game501').classList.remove('hidden');
  document.getElementById('input').classList.remove('hidden');
  update501();
}
function startCricket(){
  hideAll(); setStatus('Cricket');
  mode='cricket'; submode='single';
  players=['Spieler 1','Spieler 2']; turn=0; history=[];
  cricket=[initCricket(),initCricket()];
  document.getElementById('gameCricket').classList.remove('hidden');
  document.getElementById('input').classList.remove('hidden');
  buildCricketGrid(); updateCricket();
}
function start501Tournament(){
  hideAll(); setStatus('501 â€“ Turnier Setup');
  mode='501'; submode='tournament';
  openSetup('501 â€“ Turnier Setup');
}
function startCricketTournament(){
  hideAll(); setStatus('Cricket â€“ Turnier Setup');
  mode='cricket'; submode='tournament';
  openSetup('Cricket â€“ Turnier Setup');
}

/* SETUP */
function openSetup(title){
  document.getElementById('setupTitle').textContent=title;
  document.getElementById('setup').classList.remove('hidden');
  renderNames();
}
function setGroups(g){
  groups=g;
  document.getElementById('g1').classList.toggle('active',g===1);
  document.getElementById('g2').classList.toggle('active',g===2);
}
function renderNames(){
  const n=+document.getElementById('pCount').value;
  const wrap=document.getElementById('names'); wrap.innerHTML='';
  for(let i=0;i<n;i++){
    let inp=document.createElement('input'); inp.value='Spieler '+(i+1);
    wrap.appendChild(inp);
  }
}
function confirmSetup(){
  const names=[...document.querySelectorAll('#names input')].map(i=>i.value);
  tournament={mode,groups,players:names,results:{},stage:'groups'};
  hideAll();
  startNextTournamentMatch();
}

/* TOURNAMENT FLOW (simplified but complete) */
function startNextTournamentMatch(){
  const ps=tournament.players;
  if(!tournament.schedule){
    tournament.schedule=buildSchedule(ps,groups);
    tournament.idx=0;
  }
  if(tournament.idx>=tournament.schedule.length){
    setStatus(mode==='501'?'501 â€“ Finale':'Cricket â€“ Finale');
    recordTournamentStats();
    resetAppState();
    return;
  }
  const [a,b]=tournament.schedule[tournament.idx++];
  players=[a,b]; turn=0; history=[];
  if(mode==='501'){
    scores501=[501,501];
    hideAll(); setStatus('501 â€“ Gruppenphase');
    document.getElementById('game501').classList.remove('hidden');
    document.getElementById('input').classList.remove('hidden');
    update501();
  }else{
    cricket=[initCricket(),initCricket()];
    hideAll(); setStatus('Cricket â€“ Gruppenphase');
    document.getElementById('gameCricket').classList.remove('hidden');
    document.getElementById('input').classList.remove('hidden');
    buildCricketGrid(); updateCricket();
  }
}

/* SCHEDULE */
function buildSchedule(names,groups){
  let arr=[];
  if(groups===1){
    for(let i=0;i<names.length;i++)
      for(let j=i+1;j<names.length;j++) arr.push([names[i],names[j]]);
  }else{
    const mid=Math.ceil(names.length/2);
    const A=names.slice(0,mid), B=names.slice(mid);
    [A,B].forEach(G=>{
      for(let i=0;i<G.length;i++)
        for(let j=i+1;j<G.length;j++) arr.push([G[i],G[j]]);
    });
  }
  return arr;
}

/* INPUT */
function setMult(m){
  mult=m;
  document.querySelectorAll('#input .mode').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('#input .mode')[m-1].classList.add('active');
}
function resetMult(){ setMult(1); }
function manualThrow(){
  const v=+document.getElementById('manual').value;
  if(v>=0&&v<=60) throwDart(v);
  document.getElementById('manual').value='';
}
function snapshot(){
  return JSON.stringify({scores501,cricket,turn});
}
function restore(s){
  const o=JSON.parse(s); scores501=o.scores501; cricket=o.cricket; turn=o.turn;
}

/* THROW */
function throwDart(v){
  history.push(snapshot());
  if(mode==='501'){
    let cur=scores501[turn]-v;
    if(cur<0 || (cur===0 && v%2!==0)){ restore(history.pop()); nextTurn(); resetMult(); return; }
    scores501[turn]=cur;
    if(cur===0){ saveStats('501'); if(submode==='tournament'){ startNextTournamentMatch(); } else { resetAppState(); } return; }
    update501();
  }else{
    const map={15:15,16:16,17:17,18:18,19:19,20:20,25:25,50:25};
    const base=(v===50?25:v/mult);
    const k=map[base];
    if(k){
      for(let i=0;i<mult;i++){
        if(cricket[turn].m[k]<3) cricket[turn].m[k]++;
        else if(cricket[1-turn].m[k]<3) cricket[turn].pts+=k;
      }
    }
    updateCricket();
    checkCricketEnd();
  }
  resetMult();
}
function nextTurn(){ turn=1-turn; update501(); updateCricket(); }
function undo(){ if(history.length){ restore(history.pop()); update501(); updateCricket(); } }

/* 501 UI */
function update501(){
  if(mode!=='501') return;
  document.getElementById('p0n').textContent=players[0];
  document.getElementById('p1n').textContent=players[1];
  document.getElementById('s0').textContent=scores501[0];
  document.getElementById('s1').textContent=scores501[1];
  document.getElementById('p0').classList.toggle('active',turn===0);
  document.getElementById('p1').classList.toggle('active',turn===1);
}

/* CRICKET */
function initCricket(){
  return {pts:0,m:{20:0,19:0,18:0,17:0,16:0,15:0,25:0}};
}
function buildCricketGrid(){
  const g=document.getElementById('cgrid'); g.innerHTML='';
  document.getElementById('cn0').textContent=players[0];
  document.getElementById('cn1').textContent=players[1];
  cricketTargets.forEach(t=>{
    const l=document.createElement('div'); l.className='marks'; l.id='m0_'+t;
    const c=document.createElement('div'); c.className='center'; c.textContent=(t===25?'BULL':t);
    const r=document.createElement('div'); r.className='marks'; r.id='m1_'+t;
    g.append(l,c,r);
  });
}
function updateCricket(){
  if(mode!=='cricket') return;
  document.getElementById('cp0').textContent=cricket[0].pts+' Punkte';
  document.getElementById('cp1').textContent=cricket[1].pts+' Punkte';
  cricketTargets.forEach(t=>{
    for(let p=0;p<2;p++){
      const el=document.getElementById('m'+p+'_'+t); el.innerHTML='';
      for(let i=0;i<3;i++){
        const d=document.createElement('div');
        d.className='mark'+(cricket[p].m[t]>i?' on':'');
        el.appendChild(d);
      }
      el.classList.toggle('activePlayer',p===turn);
    }
  });
}
function checkCricketEnd(){
  const allClosed=cricketTargets.every(t=>cricket[0].m[t]>=3 && cricket[1].m[t]>=3);
  if(allClosed && cricket[0].pts!==cricket[1].pts){
    saveStats('cricket');
    if(submode==='tournament'){ startNextTournamentMatch(); } else { resetAppState(); }
  }
}

/* STATS */
function loadStats(){ return JSON.parse(localStorage.getItem(statsKey)||'[]'); }
function saveStats(type){
  const stats=loadStats();
  stats.push({date:new Date().toISOString(),type,players:[...players]});
  localStorage.setItem(statsKey,JSON.stringify(stats));
}
function recordTournamentStats(){
  saveStats(mode==='501'?'501-tournament':'cricket-tournament');
}
function showStats(){
  hideAll(); setStatus('Statistiken & Historie');
  const panel=document.getElementById('tablePanel'); panel.classList.remove('hidden');
  const data=loadStats();
  let html='<table class="table"><tr><th>Datum</th><th>Typ</th><th>Spieler</th></tr>';
  data.forEach(d=>{
    html+=`<tr><td>${new Date(d.date).toLocaleString()}</td><td>${d.type}</td><td>${d.players.join(' vs ')}</td></tr>`;
  });
  html+='</table><button class="btn red" onclick="clearStats()">Statistiken lÃ¶schen</button>';
  panel.innerHTML=html;
}
function clearStats(){
  localStorage.removeItem(statsKey);
  showStats();
}
</script>
</body>
</html>
