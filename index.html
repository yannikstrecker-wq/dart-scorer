<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dart App</title>
<style>
:root{
  --green:#1e7f4f;
  --red:#b8322a;
  --gold:#d4af37;
  --bg:#050806;
  --panel:#111;
  --text:#f5f5f5;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top,#1b5e3a 0%,var(--bg) 70%);
  font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  color:var(--text);
  padding:10px;
}
.app{max-width:1200px;margin:auto}
.header{
  text-align:center;border:2px solid var(--gold);border-radius:14px;
  padding:12px;background:#000;margin-bottom:12px
}
.panel{background:var(--panel);padding:12px;border-radius:14px;margin-bottom:12px}
.hidden{display:none}
.modes{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.mode{
  padding:10px;font-weight:900;border-radius:10px;border:2px solid #0f5d35;
  background:#000;color:#eee
}
.mode.active{background:var(--gold);color:#000}
.scores{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.playerBox{
  background:#000;border:2px solid #0f5d35;border-radius:12px;padding:10px
}
.playerBox.active{border-color:var(--gold)}
.score{font-size:42px;font-weight:900}
.sub{font-weight:800;opacity:.9}
.checkout{color:#ffd700;font-weight:900}
.numbers{display:grid;grid-template-columns:repeat(6,1fr);gap:6px}
.num{
  padding:14px;font-size:18px;font-weight:900;background:#000;color:#fff;
  border:2px solid #0f5d35;border-radius:10px
}
.bull{color:#ffd700}
.actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
.btn{padding:14px;font-weight:900;border-radius:12px;border:none}
.green{background:var(--green);color:#000}
.red{background:var(--red);color:#fff}
.quickInput{display:flex;gap:6px;margin-top:6px}
.quickInput input{
  flex:1;padding:10px;border-radius:8px;border:2px solid #333;
  background:#000;color:#fff;text-align:center;font-weight:900
}
.quickInput button{
  padding:10px 14px;border-radius:8px;border:none;font-weight:900;
  background:var(--gold)
}
.table{width:100%;border-collapse:collapse;margin-top:8px}
.table th,.table td{border-bottom:1px solid #333;padding:6px;text-align:center}
.table th{color:var(--gold)}
.small{font-size:12px;opacity:.9}
</style>
</head>
<body>
<div class="app">
  <div class="header"><h1>ðŸŽ¯ Dart App</h1></div>

  <!-- START -->
  <div id="start" class="panel">
    <h3>Spielauswahl</h3>
    <div class="modes">
      <button class="mode active" onclick="selectMode('501')">501 â€“ 1vs1</button>
      <button class="mode" onclick="selectMode('cricket')">Cricket â€“ 1vs1</button>
      <button class="mode" onclick="selectMode('tournament')">Turnier</button>
    </div>
  </div>

  <!-- TOURNAMENT SETUP -->
  <div id="tSetup" class="panel hidden">
    <h3>Turnier Setup</h3>
    <label>Spieleranzahl (4â€“7):</label>
    <input id="pCount" type="number" min="4" max="7" value="4">
    <div id="pNames"></div>
    <button class="btn green" onclick="startTournament()">Turnier starten</button>
  </div>

  <!-- SCOREBOARD -->
  <div id="game" class="panel hidden">
    <div class="scores">
      <div class="playerBox active" id="p0">
        <div class="sub" id="p0n"></div>
        <div class="score" id="s0"></div>
        <div class="checkout" id="c0"></div>
      </div>
      <div class="playerBox" id="p1">
        <div class="sub" id="p1n"></div>
        <div class="score" id="s1"></div>
        <div class="checkout" id="c1"></div>
      </div>
    </div>
  </div>

  <!-- INPUT -->
  <div id="input" class="panel hidden">
    <div class="modes">
      <button class="mode active" onclick="setMult(1)">Single</button>
      <button class="mode" onclick="setMult(2)">Double</button>
      <button class="mode" onclick="setMult(3)">Triple</button>
    </div>
    <div class="numbers" id="nums"></div>
    <div class="quickInput">
      <input id="manual" type="number" min="0" max="60" placeholder="Wurf">
      <button onclick="manualThrow()">OK</button>
    </div>
    <div class="actions">
      <button class="btn red" onclick="undo()">Undo</button>
      <button class="btn green" onclick="nextTurn()">Weiter</button>
    </div>
  </div>

  <!-- TABLE / RESULTS -->
  <div id="tablePanel" class="panel hidden"></div>
</div>

<script>
/* ---------- STATE ---------- */
let mode='501'; // 501 | cricket | tournament
let mult=1;
let turn=0;
let history=[];
let players=[];
let scores=[];
let cricket;
let tournament;

/* ---------- INIT ---------- */
const numsEl=document.getElementById('nums');
(function buildNums(){
  for(let i=0;i<=20;i++){
    const b=document.createElement('button');
    b.className='num';
    b.textContent=i;
    b.onclick=()=>throwDart(i*mult);
    numsEl.appendChild(b);
  }
  const b25=document.createElement('button');
  b25.className='num bull'; b25.textContent='BULL';
  b25.onclick=()=>throwDart(25);
  numsEl.appendChild(b25);
  const b50=document.createElement('button');
  b50.className='num bull'; b50.textContent='DBULL';
  b50.onclick=()=>throwDart(50);
  numsEl.appendChild(b50);
})();

/* ---------- UI ---------- */
function selectMode(m){
  document.querySelectorAll('#start .mode').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  mode=m;
  document.getElementById('start').classList.add('hidden');
  if(m==='tournament'){
    setupTournamentUI();
  }else{
    startGame(m==='501'?['Spieler 1','Spieler 2']:['Spieler 1','Spieler 2']);
  }
}
function setupTournamentUI(){
  document.getElementById('tSetup').classList.remove('hidden');
  renderNames();
}
function renderNames(){
  const n=+document.getElementById('pCount').value;
  const wrap=document.getElementById('pNames');
  wrap.innerHTML='';
  for(let i=0;i<n;i++){
    const inp=document.createElement('input');
    inp.placeholder='Spieler '+(i+1);
    inp.value='Spieler '+(i+1);
    wrap.appendChild(inp);
  }
}

/* ---------- GAME START ---------- */
function startGame(names){
  players=names.slice(0,2);
  scores = (mode==='501') ? [501,501] : [0,0];
  cricket = (mode==='cricket') ? initCricket() : null;
  turn=0; history=[];
  document.getElementById('tSetup').classList.add('hidden');
  document.getElementById('game').classList.remove('hidden');
  document.getElementById('input').classList.remove('hidden');
  document.getElementById('tablePanel').classList.add('hidden');
  updateUI();
}
function initCricket(){
  const marks=()=>({15:0,16:0,17:0,18:0,19:0,20:0,25:0});
  return [{m:marks(),pts:0},{m:marks(),pts:0}];
}

/* ---------- THROW ---------- */
function setMult(m){
  mult=m;
  document.querySelectorAll('#input .mode').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('#input .mode')[m-1].classList.add('active');
}
function resetMult(){ setMult(1); }
function manualThrow(){
  const v=+document.getElementById('manual').value;
  if(!Number.isInteger(v)||v<0||v>60) return;
  throwDart(v);
  document.getElementById('manual').value='';
}
function throwDart(v){
  history.push(snapshot());
  if(mode==='501'){
    const cur=scores[turn]-v;
    if(cur<0 || (cur===0 && (v%2!==0))) { restore(); nextTurn(); resetMult(); return; }
    scores[turn]=cur;
    if(cur===0){ finishLeg(turn); }
  }else if(mode==='cricket'){
    handleCricket(v);
  }
  resetMult();
  updateUI();
}
function handleCricket(v){
  const map={15:15,16:16,17:17,18:18,19:19,20:20,25:25};
  const k=map[v]||null;
  if(!k) return;
  const me=cricket[turn], opp=cricket[1-turn];
  for(let i=0;i<mult;i++){
    if(me.m[k]<3) me.m[k]++;
    else if(opp.m[k]<3) me.pts+=k;
  }
}

/* ---------- FLOW ---------- */
function nextTurn(){ turn=1-turn; updateUI(); }
function undo(){ if(history.length) restore(history.pop()); updateUI(); }
function snapshot(){ return JSON.stringify({scores,cricket,turn}); }
function restore(s){
  const o=JSON.parse(s);
  scores=o.scores; cricket=o.cricket; turn=o.turn;
}
function finishLeg(winner){
  if(mode!=='tournament'){ alert(players[winner]+' gewinnt!'); startGame(players); return; }
  recordTournamentResult(winner);
}

/* ---------- UI UPDATE ---------- */
function updateUI(){
  document.getElementById('p0n').textContent=players[0];
  document.getElementById('p1n').textContent=players[1];
  document.getElementById('s0').textContent=(mode==='501')?scores[0]:cricket?cricket[0].pts:'';
  document.getElementById('s1').textContent=(mode==='501')?scores[1]:cricket?cricket[1].pts:'';
  document.getElementById('p0').classList.toggle('active',turn===0);
  document.getElementById('p1').classList.toggle('active',turn===1);
  document.getElementById('c0').textContent='';
  document.getElementById('c1').textContent='';
}

/* ---------- TOURNAMENT ---------- */
function startTournament(){
  const names=[...document.querySelectorAll('#pNames input')].map(i=>i.value||'Spieler');
  tournament={
    players:names,
    table:names.map(n=>({n,pts:0,legs:0})),
    matches:[],
    idx:0
  };
  for(let i=0;i<names.length;i++)
    for(let j=i+1;j<names.length;j++)
      tournament.matches.push([names[i],names[j]]);
  loadMatch();
}
function loadMatch(){
  if(tournament.idx>=tournament.matches.length){ showTable(); return; }
  const m=tournament.matches[tournament.idx];
  mode='501';
  startGame(m);
}
function recordTournamentResult(w){
  const m=tournament.matches[tournament.idx];
  const win=players[w], lose=players[1-w];
  const tw=tournament.table.find(x=>x.n===win);
  const tl=tournament.table.find(x=>x.n===lose);
  tw.pts+=2; tw.legs++; tl.legs--;
  tournament.idx++;
  loadMatch();
}
function showTable(){
  const p=document.getElementById('tablePanel');
  p.classList.remove('hidden');
  p.innerHTML='<h3>Tabelle</h3>';
  const t=document.createElement('table'); t.className='table';
  t.innerHTML='<tr><th>Spieler</th><th>Punkte</th><th>Legs</th></tr>';
  tournament.table.sort((a,b)=>b.pts-a.pts||b.legs-a.legs)
    .forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${r.n}</td><td>${r.pts}</td><td>${r.legs}</td>`;
      t.appendChild(tr);
    });
  p.appendChild(t);
}

/* ---------- VALIDATION ---------- */
// geprÃ¼fte Variablen, keine Duplikate, Bust- & Turnier-Ende behandelt
</script>
</body>
</html>
